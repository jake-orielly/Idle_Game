<!DOCTYPE html>
<html>
<body>
<style>
    td {
        border: 1px solid black;
        padding-left: 12px;
        padding-right: 12px;
    }
</style>

<script>
    var resourceLabels = ["food","wood","stone"];
    var resources = {food:0,wood:0,stone:0};
    var structureLabels = ["hut"];
    var structures = [0];
    var structureCost = [{wood:4,scaling:1}];
    var citizens = [0,0];
    var citizenData = {food:{alloted:0,income:0},wood:{alloted:0,income:0},stone:{alloted:0,income:0}};
    var upgrades = {stoneHatchet:{cost:{wood:5,stone:5},text:"Stone Hatchet"}};
</script>    
    
<table>    
    <tr>
        <td><h1> Resources </h1></td>
        <td><h1> Citizens </h1></td>
    </tr>
    <tr>
        <td><script>
            var table = "<table>";

            for (var i = 0; i < resourceLabels.length; i++) {
                table += "<tr><td><div id=" + resourceLabels[i] + ">" + resourceLabels[i] + ": 0</div></td>";
                var button = "<button type=\"button\" class= 'button' onclick=handleButton(0," + i + ")> Gather " + resourceLabels[i] + " </button>"
                table += "<td>" + button + "</td> </tr>";
            }

            table += "</table>";

            document.write(table);
        </script></td>
        <td><script>
            var table = "<table id='citizens'>";

            for (var i = 0; i < resourceLabels.length; i++) {
                table += "<tr><td><div id=citizens" + resourceLabels[i] + ">" + resourceLabels[i] + ": " + citizenData[resourceLabels[i]].alloted + "</div></td>";
                let button1 = "<button type='button' class='button' onclick= allotCitizens(" + i + ",1)>+</button>";
                let button2 = "<button type='button' class='button' onclick= allotCitizens(" + i + ",-1)>-</button>";
                table += "<td>" + button1 + button2 + "</td><td id=income" + resourceLabels[i] + ">" + citizenData[resourceLabels[i]].income + "/s</td>"
                table += "</tr>";
            }

            table += "<tr><td><div id='citizenIdle'>Idle: 0 </div></td>";
            table += "<td><div id='citizenTotal'>Total: 0 </div></td></tr>";
            table += "</table>";

            document.write(table);
        </script></td>
    </tr>
    <tr>
        <td><h1> Buildings </h1></td>
        <td><h1> Upgrades </h1></td>
    </tr>
    <tr>
        <td><table>
            <tr>
                <td> <div id="hut">Hut: 0</div></td>
                <td><table>
                    <tr>
                        <td><button type="button" class= 'button' onclick=handleButton(1,0)> Build Hut </button></td>
                    </tr>    
                </table></td>
                <td><script>
                    var table = "<table>";

                    for (var name in upgrades) {
                        var button = "<button type=\"button\" class= 'button' id = " + name + "onclick=stoneHatchet()> Prototype " + upgrades[name].text + " </button>"
                        table += "<td>" + button + "</td> </tr>";
                    }

                    table += "</table>";

                    document.write(table);
                </script></td>
            </tr>
        </table></td>
    </tr>
    
</table>

<script>

setInterval(function(){refresh();},1000);

    
function refresh() {
    for (var id = 0; id < resourceLabels.length; id++) {
        var string = document.getElementById(resourceLabels[id]).innerHTML;
        string = string.split(" ");
        resources[resourceLabels[id]] += citizenData[resourceLabels[id]].income;
        document.getElementById(resourceLabels[id]).innerHTML = string[0] + " " + (resources[resourceLabels[id]]);      
    } 
    
    updateLabels();
}
    
function handleButton(group, id) {
    if (group == 0)
        resourceButton(id);
    else if (group == 1)
        buildingButton(id);
}

function stoneHatchet(){
    alert("fuck!!!")
}    
    
function allotCitizens(item,sign) {
    if ((sign == 1 && citizens[0] > 0) || 
        (sign == -1 && citizenData[resourceLabels[item]].alloted > 0)) {
        citizenData[resourceLabels[item]].alloted += sign;
        citizens[0] -= sign;
        let alloted = document.getElementById("citizens" + resourceLabels[item]).innerHTML;
        alloted = alloted.split(" ");
        document.getElementById("citizens" + resourceLabels[item]).innerHTML = alloted[0] + " " + citizenData[resourceLabels[item]].alloted;
        let idle = document.getElementById("citizenIdle").innerHTML;
        idle = idle.split(" ");
        document.getElementById("citizenIdle").innerHTML = idle[0] + " " + citizens[0];
        citizenData[resourceLabels[item]].income += sign;
        document.getElementById("income" + resourceLabels[item]).innerHTML = citizenData[resourceLabels[item]].income + "/s";
    }
}
    
function buildingButton(id) {
    var sufficient = true;
    
    for(var name in structureCost[id]) {
        var value = structureCost[id][name];
        if (name != "scaling" && structureCost[id][name] > resources[name])
            sufficient = false; 
    }
    
    if (sufficient) {
        var string = document.getElementById(structureLabels[id]).innerHTML;
        string = string.split(" ");
        structures[id] += 1;
        document.getElementById(structureLabels[id]).innerHTML = string[0] + " " + (structures[id]);
        
        for(var name in structureCost[id]) {
            resources[name] -= 4; 
        }
        
        structureBuilt(id);
        updateLabels();
    }
}
    
function structureBuilt(id){
    if (id == 0) {
        let string = document.getElementById("citizenIdle").innerHTML;
        string = string.split(" ");
        citizens[0] += 1;
        document.getElementById("citizenIdle").innerHTML = string[0] + " " + citizens[0]; 
        string = document.getElementById("citizenTotal").innerHTML;
        string = string.split(" ");
        citizens[1] += 1;
        document.getElementById("citizenTotal").innerHTML = string[0] + " " + citizens[1]; 
    }
}

function resourceButton(id) {
    var string = document.getElementById(resourceLabels[id]).innerHTML;
    string = string.split(" ");
    resources[resourceLabels[id]] += 1;
    document.getElementById(resourceLabels[id]).innerHTML = string[0] + " " + (resources[resourceLabels[id]]);    
}
    
function updateLabels() {
    for(var id in resources) {
        let string = document.getElementById(id).innerHTML;
        string = string.split(" ");
        document.getElementById(id).innerHTML = string[0] + " " + (resources[id]); 
    }
}

</script>
    
</body>
</html>